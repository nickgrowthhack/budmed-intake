const form=document.getElementById('form')
const statusEl=document.getElementById('status')
function getToken(){const u=new URL(window.location.href);return u.searchParams.get('token')||''}
function getChecked(n){return Array.from(document.querySelectorAll(`input[name="${n}"]:checked`)).map(i=>i.value)}
form.addEventListener('submit',async e=>{e.preventDefault();const token=getToken();if(!token){statusEl.textContent='Token inv√°lido';statusEl.classList.remove('success');statusEl.classList.add('error');return}const objetivos={gerenciamento_da_dor:getChecked('objetivos_dor'),melhora_do_sono:getChecked('objetivos_sono'),saude_mental_emocional:getChecked('objetivos_mental'),conforto_gastrointestinal:getChecked('objetivos_gastro'),condicoes_neurologicas:getChecked('objetivos_neuro'),outros_objetivos_de_saude:getChecked('objetivos_outros')};const payload={answers:{queixa_principal:document.getElementById('queixa').value,historico_relevante:document.getElementById('historico').value,alergias:document.getElementById('alergias').value,objetivos}};statusEl.textContent='Enviando...';statusEl.classList.remove('error','success');try{const r=await fetch(`/intake/${token}/response`,{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify(payload)});const j=await r.json();if(j.status==='received'){statusEl.textContent='Respostas enviadas';statusEl.classList.remove('error');statusEl.classList.add('success')}else{statusEl.textContent='Falha ao enviar';statusEl.classList.remove('success');statusEl.classList.add('error')}}catch(_){statusEl.textContent='Erro de rede';statusEl.classList.remove('success');statusEl.classList.add('error')}})
